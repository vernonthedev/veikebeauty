!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports&&"function"==typeof require?require("jquery"):jQuery)}(function(h){"use strict";function o(e,t){var n=this;n.element=e,n.el=h(e),n.suggestions=[],n.badQueries=[],n.selectedIndex=-1,n.currentValue=n.element.value,n.timeoutId=null,n.cachedResponse={},n.onChangeTimeout=null,n.onChange=null,n.isLocal=!1,n.suggestionsContainer=null,n.noSuggestionsContainer=null,n.options=h.extend({},o.defaults,t),n.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},n.hint=null,n.hintValue="",n.selection=null,n.initialize(),n.setOptions(t)}var s={escapeRegExChars:function(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")},createNode:function(e){var t=document.createElement("div");return t.className=e,t.style.position="absolute",t.style.display="none",t}},n=27,i=9,a=13,r=38,l=39,u=40,e=h.noop;o.utils=s,(h.Autocomplete=o).defaults={ajaxSettings:{},autoSelectFirst:!1,appendTo:"body",serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:function(e,t){if(!t)return e.value;var n="("+s.escapeRegExChars(t)+")";return e.value.replace(new RegExp(n,"gi"),"<strong>$1</strong>").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/&lt;(\/?strong)&gt;/g,"<$1>")},formatGroup:function(e,t){return'<div class="autocomplete-group">'+t+"</div>"},delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:e,onSearchComplete:e,onSearchError:e,preserveInput:!1,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",currentRequest:null,triggerSelectOnValidInput:!0,preventBadQueries:!0,lookupFilter:function(e,t,n){return-1!==e.value.toLowerCase().indexOf(n)},paramName:"query",transformResult:function(e){return"string"==typeof e?h.parseJSON(e):e},showNoSuggestionNotice:!1,noSuggestionNotice:"No results",orientation:"bottom",forceFixPosition:!1},o.prototype={initialize:function(){var e,t=this,n="."+t.classes.suggestion,s=t.classes.selected,i=t.options;t.element.setAttribute("autocomplete","off"),t.noSuggestionsContainer=h('<div class="autocomplete-no-suggestion"></div>').html(this.options.noSuggestionNotice).get(0),t.suggestionsContainer=o.utils.createNode(i.containerClass),(e=h(t.suggestionsContainer)).appendTo(i.appendTo||"body"),"auto"!==i.width&&e.css("width",i.width),e.on("mouseover.autocomplete",n,function(){t.activate(h(this).data("index"))}),e.on("mouseout.autocomplete",function(){t.selectedIndex=-1,e.children("."+s).removeClass(s)}),e.on("click.autocomplete",n,function(){t.select(h(this).data("index"))}),e.on("click.autocomplete",function(){clearTimeout(t.blurTimeoutId)}),t.fixPositionCapture=function(){t.visible&&t.fixPosition()},h(window).on("resize.autocomplete",t.fixPositionCapture),t.el.on("keydown.autocomplete",function(e){t.onKeyPress(e)}),t.el.on("keyup.autocomplete",function(e){t.onKeyUp(e)}),t.el.on("blur.autocomplete",function(){t.onBlur()}),t.el.on("focus.autocomplete",function(){t.onFocus()}),t.el.on("change.autocomplete",function(e){t.onKeyUp(e)}),t.el.on("input.autocomplete",function(e){t.onKeyUp(e)})},onFocus:function(){var e=this;e.fixPosition(),e.el.val().length>=e.options.minChars&&e.onValueChange()},onBlur:function(){var e=this;e.blurTimeoutId=setTimeout(function(){e.hide()},200)},abortAjax:function(){var e=this;e.currentRequest&&(e.currentRequest.abort(),e.currentRequest=null)},setOptions:function(e){var t=this,n=h.extend({},t.options,e);t.isLocal=Array.isArray(n.lookup),t.isLocal&&(n.lookup=t.verifySuggestionsFormat(n.lookup)),n.orientation=t.validateOrientation(n.orientation,"bottom"),h(t.suggestionsContainer).css({"max-height":n.maxHeight+"px",width:n.width+"px","z-index":n.zIndex}),this.options=n},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){var e=this;e.disabled=!0,clearTimeout(e.onChangeTimeout),e.abortAjax()},enable:function(){this.disabled=!1},fixPosition:function(){var e=this,t=h(e.suggestionsContainer),n=t.parent().get(0);if(n===document.body||e.options.forceFixPosition){var s=e.options.orientation,i=t.outerHeight(),o=e.el.outerHeight(),a=e.el.offset(),r={top:a.top,left:a.left};if("auto"===s){var l=h(window).height(),u=h(window).scrollTop(),c=-u+a.top-i,d=u+l-(a.top+o+i);s=Math.max(c,d)===c?"top":"bottom"}if(r.top+="top"===s?-i:o,n!==document.body){var g,p=t.css("opacity");e.visible||t.css("opacity",0).show(),g=t.offsetParent().offset(),r.top-=g.top,r.left-=g.left,e.visible||t.css("opacity",p).hide()}"auto"===e.options.width&&(r.width=e.el.outerWidth()+"px"),t.css(r)}},isCursorAtEnd:function(){var e,t=this.el.val().length,n=this.element.selectionStart;return"number"==typeof n?n===t:!document.selection||((e=document.selection.createRange()).moveStart("character",-t),t===e.text.length)},onKeyPress:function(e){var t=this;if(t.disabled||t.visible||e.which!==u||!t.currentValue){if(!t.disabled&&t.visible){switch(e.which){case n:t.el.val(t.currentValue),t.hide();break;case l:if(t.hint&&t.options.onHint&&t.isCursorAtEnd()){t.selectHint();break}return;case i:if(t.hint&&t.options.onHint)return void t.selectHint();if(-1===t.selectedIndex)return void t.hide();if(t.select(t.selectedIndex),!1===t.options.tabDisabled)return;break;case a:if(-1===t.selectedIndex)return void t.hide();t.select(t.selectedIndex);break;case r:t.moveUp();break;case u:t.moveDown();break;default:return}e.stopImmediatePropagation(),e.preventDefault()}}else t.suggest()},onKeyUp:function(e){var t=this;if(!t.disabled){switch(e.which){case r:case u:return}clearTimeout(t.onChangeTimeout),t.currentValue!==t.el.val()&&(t.findBestHint(),0<t.options.deferRequestBy?t.onChangeTimeout=setTimeout(function(){t.onValueChange()},t.options.deferRequestBy):t.onValueChange())}},onValueChange:function(){var e=this,t=e.options,n=e.el.val(),s=e.getQuery(n);return e.selection&&e.currentValue!==s&&(e.selection=null,(t.onInvalidateSelection||h.noop).call(e.element)),clearTimeout(e.onChangeTimeout),e.currentValue=n,e.selectedIndex=-1,t.triggerSelectOnValidInput&&e.isExactMatch(s)?void e.select(0):void(s.length<t.minChars?e.hide():e.getSuggestions(s))},isExactMatch:function(e){var t=this.suggestions;return 1===t.length&&t[0].value.toLowerCase()===e.toLowerCase()},getQuery:function(e){var t,n=this.options.delimiter;return n?(t=e.split(n),h.trim(t[t.length-1])):e},getSuggestionsLocal:function(t){var e,n=this.options,s=t.toLowerCase(),i=n.lookupFilter,o=parseInt(n.lookupLimit,10);return e={suggestions:h.grep(n.lookup,function(e){return i(e,t,s)})},o&&e.suggestions.length>o&&(e.suggestions=e.suggestions.slice(0,o)),e},getSuggestions:function(s){var e,t,n,i,o=this,a=o.options,r=a.serviceUrl;if(a.params[a.paramName]=s,!1!==a.onSearchStart.call(o.element,a.params)){if(t=a.ignoreParams?null:a.params,h.isFunction(a.lookup))return void a.lookup(s,function(e){o.suggestions=e.suggestions,o.suggest(),a.onSearchComplete.call(o.element,s,e.suggestions)});(e=o.isLocal?o.getSuggestionsLocal(s):(h.isFunction(r)&&(r=r.call(o.element,s)),n=r+"?"+h.param(t||{}),o.cachedResponse[n]))&&Array.isArray(e.suggestions)?(o.suggestions=e.suggestions,o.suggest(),a.onSearchComplete.call(o.element,s,e.suggestions)):o.isBadQuery(s)?a.onSearchComplete.call(o.element,s,[]):(o.abortAjax(),i={url:r,data:t,type:a.type,dataType:a.dataType},h.extend(i,a.ajaxSettings),o.currentRequest=h.ajax(i).done(function(e){var t;o.currentRequest=null,t=a.transformResult(e,s),o.processResponse(t,s,n),a.onSearchComplete.call(o.element,s,t.suggestions)}).fail(function(e,t,n){a.onSearchError.call(o.element,s,e,t,n)}))}},isBadQuery:function(e){if(!this.options.preventBadQueries)return!1;for(var t=this.badQueries,n=t.length;n--;)if(0===e.indexOf(t[n]))return!0;return!1},hide:function(){var e=this,t=h(e.suggestionsContainer);h.isFunction(e.options.onHide)&&e.visible&&e.options.onHide.call(e.element,t),e.visible=!1,e.selectedIndex=-1,clearTimeout(e.onChangeTimeout),h(e.suggestionsContainer).hide(),e.signalHint(null)},suggest:function(){if(this.suggestions.length){var i,e=this,o=e.options,a=o.groupBy,r=o.formatResult,l=e.getQuery(e.currentValue),u=e.classes.suggestion,t=e.classes.selected,n=h(e.suggestionsContainer),s=h(e.noSuggestionsContainer),c=o.beforeRender,d="";return o.triggerSelectOnValidInput&&e.isExactMatch(l)?void e.select(0):(h.each(e.suggestions,function(e,t){var n,s;a&&(d+=(s=(n=t).data[a],i===s?"":(i=s,o.formatGroup(n,i)))),d+='<div class="'+u+'" data-index="'+e+'">'+r(t,l,e)+"</div>"}),this.adjustContainerWidth(),s.detach(),n.html(d),h.isFunction(c)&&c.call(e.element,n,e.suggestions),e.fixPosition(),n.show(),o.autoSelectFirst&&(e.selectedIndex=0,n.scrollTop(0),n.children("."+u).first().addClass(t)),e.visible=!0,void e.findBestHint())}this.options.showNoSuggestionNotice?this.noSuggestions():this.hide()},noSuggestions:function(){var e=this,t=e.options.beforeRender,n=h(e.suggestionsContainer),s=h(e.noSuggestionsContainer);this.adjustContainerWidth(),s.detach(),n.empty(),n.append(s),h.isFunction(t)&&t.call(e.element,n,e.suggestions),e.fixPosition(),n.show(),e.visible=!0},adjustContainerWidth:function(){var e,t=this.options,n=h(this.suggestionsContainer);"auto"===t.width?(e=this.el.outerWidth(),n.css("width",0<e?e:300)):"flex"===t.width&&n.css("width","")},findBestHint:function(){var s=this.el.val().toLowerCase(),i=null;s&&(h.each(this.suggestions,function(e,t){var n=0===t.value.toLowerCase().indexOf(s);return n&&(i=t),!n}),this.signalHint(i))},signalHint:function(e){var t="",n=this;e&&(t=n.currentValue+e.value.substr(n.currentValue.length)),n.hintValue!==t&&(n.hintValue=t,n.hint=e,(this.options.onHint||h.noop)(t))},verifySuggestionsFormat:function(e){return e.length&&"string"==typeof e[0]?h.map(e,function(e){return{value:e,data:null}}):e},validateOrientation:function(e,t){return e=h.trim(e||"").toLowerCase(),-1===h.inArray(e,["auto","bottom","top"])&&(e=t),e},processResponse:function(e,t,n){var s=this,i=s.options;e.suggestions=s.verifySuggestionsFormat(e.suggestions),i.noCache||(s.cachedResponse[n]=e,i.preventBadQueries&&!e.suggestions.length&&s.badQueries.push(t)),t===s.getQuery(s.currentValue)&&(s.suggestions=e.suggestions,s.suggest())},activate:function(e){var t,n=this,s=n.classes.selected,i=h(n.suggestionsContainer),o=i.find("."+n.classes.suggestion);return i.find("."+s).removeClass(s),n.selectedIndex=e,-1!==n.selectedIndex&&o.length>n.selectedIndex?(t=o.get(n.selectedIndex),h(t).addClass(s),t):null},selectHint:function(){var e=h.inArray(this.hint,this.suggestions);this.select(e)},select:function(e){this.hide(),this.onSelect(e)},moveUp:function(){var e=this;if(-1!==e.selectedIndex)return 0===e.selectedIndex?(h(e.suggestionsContainer).children().first().removeClass(e.classes.selected),e.selectedIndex=-1,e.el.val(e.currentValue),void e.findBestHint()):void e.adjustScroll(e.selectedIndex-1)},moveDown:function(){this.selectedIndex!==this.suggestions.length-1&&this.adjustScroll(this.selectedIndex+1)},adjustScroll:function(e){var t=this,n=t.activate(e);if(n){var s,i,o,a=h(n).outerHeight();s=n.offsetTop,o=(i=h(t.suggestionsContainer).scrollTop())+t.options.maxHeight-a,s<i?h(t.suggestionsContainer).scrollTop(s):o<s&&h(t.suggestionsContainer).scrollTop(s-t.options.maxHeight+a),t.options.preserveInput||t.el.val(t.getValue(t.suggestions[e].value)),t.signalHint(null)}},onSelect:function(e){var t=this,n=t.options.onSelect,s=t.suggestions[e];t.currentValue=t.getValue(s.value),t.currentValue===t.el.val()||t.options.preserveInput||t.el.val(t.currentValue),t.signalHint(null),t.suggestions=[],t.selection=s,h.isFunction(n)&&n.call(t.element,s)},getValue:function(e){var t,n,s=this.options.delimiter;return s?1===(n=(t=this.currentValue).split(s)).length?e:t.substr(0,t.length-n[n.length-1].length)+e:e},dispose:function(){this.el.off(".autocomplete").removeData("autocomplete"),h(window).off("resize.autocomplete",this.fixPositionCapture),h(this.suggestionsContainer).remove()}},h.fn.devbridgeAutocomplete=function(n,s){var i="autocomplete";return arguments.length?this.each(function(){var e=h(this),t=e.data(i);"string"==typeof n?t&&"function"==typeof t[n]&&t[n](s):(t&&t.dispose&&t.dispose(),t=new o(this,n),e.data(i,t))}):this.first().data(i)},h.fn.autocomplete||(h.fn.autocomplete=h.fn.devbridgeAutocomplete)}),function(g){g(".topsearch-entry").each(function(){var e=g(this).find(".search"),i=e.data("show_image"),o=e.data("show_price"),t=e.data("character"),n=e.data("search_type"),a=e.data("height_image"),r=e.data("width_image"),s=e.data("limit"),l=g(this).find(".search-append"),u=g(this).find(".category-selection"),c=sw_livesearch.ajaxurl+"?action=sw_search_products_callback&limit="+s+"&search_type="+n;if(u.length&&""!==u.val()&&(c+="&product_cat="+u.val()),g(this).find(".autosearch-input").devbridgeAutocomplete({minChars:t,appendTo:l,triggerSelectOnValidInput:!1,serviceUrl:c,ajaxSettings:{contentType:"application/x-www-form-urlencoded; charset=UTF-8"},onSearchStart:function(){g(".button-search-pro").removeClass("loading"),g(".button-search-pro").addClass("loading")},onSelect:function(e){-1!=e.id&&(window.location.href=e.link)},onSearchComplete:function(){g(".button-search-pro").removeClass("loading")},beforeRender:function(e){g(e).removeAttr("style")},formatResult:function(e,t){var n="("+g.Autocomplete.utils.escapeRegExChars(t)+")",s="";return-1!=e.id?(s+='<a class="media-left" href="'+e.link+'">',i&&(s+='<img width="'+r+'" height="'+a+'" class="pull-left" src="'+e.img+'">'),s+='<div class="media-body">',s+="<span>"+e.value.replace(new RegExp(n,"gi"),"<strong>$1</strong>")+"</span>",s+='<div class="search-meta">',""!=e.sku&&(s+='<div class="sku"><span>'+sw_livesearch.sku+": </span>"+e.sku.replace(new RegExp(n,"gi"),"<strong>$1</strong>")+"</div>"),o&&(s+=e.price),s+="</div>",s+="</div>",s+="</a>"):s+='<div class="no-result">'+e.value.replace(new RegExp(n,"gi"),"<strong>$1</strong>")+"</div>",s}}),u.length){var d=g(this).find(".autosearch-input").devbridgeAutocomplete();u.on("change",function(e){""!=u.val()?d.setOptions({serviceUrl:sw_livesearch.ajaxurl+"?action=sw_search_products_callback&limit="+s+"&search_type="+n+"&product_cat="+u.val()}):d.setOptions({serviceUrl:sw_livesearch.ajaxurl+"?action=sw_search_products_callback&limit="+s+"&search_type="+n}),d.hide(),d.onValueChange()})}});var n=g("#search-product ul.products-loop"),s=n.data("postids"),i=n.data("maxpage"),o=n.data("attributes"),a=g(".sw-ajax-pagination > li > a.next"),r=g(".sw-ajax-pagination > li > a.prev"),l=1;g(document).on("click",".sw-ajax-pagination > li > a",function(e){var t=g(this);if(g(this).hasClass("disabled")||g(this).parent().hasClass("current"))return!1;g(this).hasClass("next")?l+=1:g(this).hasClass("prev")?--l:(l=g(this).data("paged"),g(this).parent().addClass("current").siblings().removeClass("current")),n.addClass("loading"),g.ajax({type:"POST",dataType:"json",url:sw_livesearch.ajaxurl,data:{action:"sw_search_pagination",post_ids:s,paged:l,attributes:o},success:function(e){t.parent().siblings().removeClass("current"),n.html(e.content),l=e.currentpage,console.log(e.currentpage),g(".sw-ajax-pagination > li").eq(e.currentpage).addClass("current"),1<e.currentpage&&e.currentpage<=i?r.removeClass("disabled"):r.addClass("disabled"),e.currentpage<i?a.removeClass("disabled"):a.addClass("disabled"),n.removeClass("loading")}}),e.preventDefault()}),g("select.sw-select-pagination").on("change",function(){var e=g(this).val();n.addClass("loading"),g.ajax({type:"POST",dataType:"json",url:sw_livesearch.ajaxurl,data:{action:"sw_search_pagination",post_ids:s,paged:e,attributes:o},success:function(e){n.html(e.content),n.removeClass("loading")}})})}(jQuery);